This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
public/vite.svg
README.md
src/App.jsx
src/assets/about.png
src/assets/home.png
src/assets/navbar-left-1st-logo.png
src/assets/navbar-left-2nd-logo.png
src/assets/navbar-right-1st-logo.png
src/assets/react.svg
src/components/FilterBar.jsx
src/components/ImageGrid.jsx
src/components/ImageLightbox.jsx
src/components/ImagePreview.jsx
src/components/Layout.jsx
src/components/LogPanel.jsx
src/components/LogTable.jsx
src/components/Navbar.jsx
src/components/StatusCard.jsx
src/hooks/useImages.js
src/hooks/useLogs.js
src/hooks/useStatus.js
src/index.css
src/lib/api.js
src/main.jsx
src/pages/Dashboard.jsx
src/pages/History.jsx
src/pages/System.jsx
src/utils/formatters.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
.env
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@tanstack/react-query": "^5.90.12",
    "axios": "^1.13.2",
    "file-saver": "^2.0.5",
    "jszip": "^3.10.1",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.10.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@tailwindcss/vite": "^4.1.17",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "tailwindcss": "^4.1.17",
    "vite": "^7.2.4"
  }
}
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="src/App.jsx">
/**
 * Main App Component
 * Sets up routing and TanStack Query provider.
 */

import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

import Layout from './components/Layout';
import Dashboard from './pages/Dashboard';
import History from './pages/History';
import System from './pages/System';

// Create a client
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 1,
      refetchOnWindowFocus: false,
    },
  },
});

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<Layout />}>
            <Route index element={<Dashboard />} />
            <Route path="history" element={<History />} />
            <Route path="system" element={<System />} />
          </Route>
        </Routes>
      </BrowserRouter>
    </QueryClientProvider>
  );
}
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/FilterBar.jsx">
/**
 * FilterBar Component
 * Date and type filters for history views.
 */

import { getToday, getDaysAgo } from '../utils/formatters';

export default function FilterBar({
    startDate,
    endDate,
    logType,
    logLevel,
    onStartDateChange,
    onEndDateChange,
    onLogTypeChange,
    onLogLevelChange,
    showLogFilters = false,
}) {
    const presets = [
        { label: 'Today', start: getToday(), end: getToday() },
        { label: '7 Days', start: getDaysAgo(7), end: getToday() },
        { label: '30 Days', start: getDaysAgo(30), end: getToday() },
        { label: '90 Days', start: getDaysAgo(90), end: getToday() },
    ];

    const applyPreset = (preset) => {
        onStartDateChange(preset.start);
        onEndDateChange(preset.end);
    };

    const clearFilters = () => {
        onStartDateChange('');
        onEndDateChange('');
        if (onLogTypeChange) onLogTypeChange('');
        if (onLogLevelChange) onLogLevelChange('');
    };

    return (
        <div className="card mb-6">
            <div className="flex flex-wrap items-center gap-4">
                {/* Date Range */}
                <div className="flex items-center gap-2">
                    <label className="text-sm text-[var(--color-text-secondary)]">From:</label>
                    <input
                        type="date"
                        value={startDate || ''}
                        onChange={(e) => onStartDateChange(e.target.value)}
                        className="text-sm"
                    />
                </div>

                <div className="flex items-center gap-2">
                    <label className="text-sm text-[var(--color-text-secondary)]">To:</label>
                    <input
                        type="date"
                        value={endDate || ''}
                        onChange={(e) => onEndDateChange(e.target.value)}
                        className="text-sm"
                    />
                </div>

                {/* Quick Presets */}
                <div className="flex gap-1">
                    {presets.map((preset) => (
                        <button
                            key={preset.label}
                            onClick={() => applyPreset(preset)}
                            className={`px-3 py-1 text-xs rounded border transition-colors ${startDate === preset.start && endDate === preset.end
                                    ? 'bg-black text-white border-black'
                                    : 'border-[var(--color-border)] hover:border-black'
                                }`}
                        >
                            {preset.label}
                        </button>
                    ))}
                </div>

                {/* Log Type Filter */}
                {showLogFilters && onLogTypeChange && (
                    <div className="flex items-center gap-2">
                        <label className="text-sm text-[var(--color-text-secondary)]">Type:</label>
                        <select
                            value={logType || ''}
                            onChange={(e) => onLogTypeChange(e.target.value)}
                            className="text-sm"
                        >
                            <option value="">All Types</option>
                            <option value="activity">Activity</option>
                            <option value="server">Server</option>
                            <option value="error">Error</option>
                        </select>
                    </div>
                )}

                {/* Log Level Filter */}
                {showLogFilters && onLogLevelChange && (
                    <div className="flex items-center gap-2">
                        <label className="text-sm text-[var(--color-text-secondary)]">Level:</label>
                        <select
                            value={logLevel || ''}
                            onChange={(e) => onLogLevelChange(e.target.value)}
                            className="text-sm"
                        >
                            <option value="">All Levels</option>
                            <option value="debug">Debug</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                )}

                {/* Clear Button */}
                <button
                    onClick={clearFilters}
                    className="text-sm text-[var(--color-text-secondary)] hover:text-black underline"
                >
                    Clear filters
                </button>
            </div>
        </div>
    );
}
</file>

<file path="src/components/ImageGrid.jsx">
/**
 * ImageGrid Component
 * Advanced grid display with multi-select, group selection, ZIP download, and lightbox.
 */

import { useState, useMemo } from 'react';
import JSZip from 'jszip';
import { saveAs } from 'file-saver';
import { useImages, useDeleteImage } from '../hooks/useImages';
import { formatFileSize, formatDimensions, formatDateTime } from '../utils/formatters';
import ImageLightbox from './ImageLightbox';

export default function ImageGrid({ startDate, endDate }) {
    const [page, setPage] = useState(1);
    const [selectedIds, setSelectedIds] = useState(new Set());
    const [selectAll, setSelectAll] = useState(false);
    const [lightboxIndex, setLightboxIndex] = useState(null);
    const [isDownloading, setIsDownloading] = useState(false);
    const pageSize = 50;

    const { data, isLoading, isError } = useImages({
        start_date: startDate,
        end_date: endDate,
        page,
        page_size: pageSize,
    });

    const deleteMutation = useDeleteImage();

    const images = data?.items ?? [];
    const total = data?.total ?? 0;
    const hasMore = data?.has_more ?? false;

    // Group images by date
    const groupedImages = useMemo(() => {
        const groups = {};
        images.forEach((img) => {
            const date = new Date(img.created_at);
            const year = date.getFullYear();
            const month = date.toLocaleString('default', { month: 'long', year: 'numeric' });
            const day = date.toLocaleDateString();

            if (!groups[year]) groups[year] = {};
            if (!groups[year][month]) groups[year][month] = {};
            if (!groups[year][month][day]) groups[year][month][day] = [];
            groups[year][month][day].push(img);
        });
        return groups;
    }, [images]);

    const allSelected = images.length > 0 && (selectAll || images.every(img => selectedIds.has(img.id)));

    const toggleSelect = (id) => {
        setSelectAll(false);
        setSelectedIds(prev => {
            const newSet = new Set(prev);
            if (newSet.has(id)) {
                newSet.delete(id);
            } else {
                newSet.add(id);
            }
            return newSet;
        });
    };

    const toggleSelectAll = () => {
        if (allSelected) {
            setSelectedIds(new Set());
            setSelectAll(false);
        } else {
            setSelectAll(true);
            setSelectedIds(new Set(images.map(img => img.id)));
        }
    };

    const toggleDaySelect = (dayImages) => {
        const dayIds = dayImages.map(img => img.id);
        const allDaySelected = dayIds.every(id => selectedIds.has(id));

        setSelectAll(false);
        setSelectedIds(prev => {
            const newSet = new Set(prev);
            if (allDaySelected) {
                dayIds.forEach(id => newSet.delete(id));
            } else {
                dayIds.forEach(id => newSet.add(id));
            }
            return newSet;
        });
    };

    const toggleMonthSelect = (monthData) => {
        const monthImages = Object.values(monthData).flat();
        const monthIds = monthImages.map(img => img.id);
        const allMonthSelected = monthIds.every(id => selectedIds.has(id));

        setSelectAll(false);
        setSelectedIds(prev => {
            const newSet = new Set(prev);
            if (allMonthSelected) {
                monthIds.forEach(id => newSet.delete(id));
            } else {
                monthIds.forEach(id => newSet.add(id));
            }
            return newSet;
        });
    };

    const toggleYearSelect = (yearData) => {
        const yearImages = Object.values(yearData).flatMap(month => Object.values(month).flat());
        const yearIds = yearImages.map(img => img.id);
        const allYearSelected = yearIds.every(id => selectedIds.has(id));

        setSelectAll(false);
        setSelectedIds(prev => {
            const newSet = new Set(prev);
            if (allYearSelected) {
                yearIds.forEach(id => newSet.delete(id));
            } else {
                yearIds.forEach(id => newSet.add(id));
            }
            return newSet;
        });
    };

    // Download selected images as ZIP via backend proxy
    const handleDownloadAll = async () => {
        const selectedImages = images.filter(img => selectedIds.has(img.id) || selectAll);
        if (selectedImages.length === 0) return;

        setIsDownloading(true);
        try {
            const zip = new JSZip();

            // Fetch images through backend proxy (avoids CORS)
            const results = await Promise.allSettled(
                selectedImages.map(async (img, index) => {
                    const response = await fetch(`/api/images/${img.id}/download`);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const blob = await response.blob();
                    const filename = selectedImages.length > 1 ? `${index + 1}_${img.filename}` : img.filename;
                    zip.file(filename, blob);
                    return img.filename;
                })
            );

            const succeeded = results.filter(r => r.status === 'fulfilled').length;
            const failed = results.filter(r => r.status === 'rejected').length;

            if (succeeded === 0) throw new Error('All downloads failed');

            const content = await zip.generateAsync({ type: 'blob' });
            const dateStr = new Date().toISOString().split('T')[0];
            saveAs(content, `images_${dateStr}_${succeeded}files.zip`);

            if (failed > 0) alert(`Downloaded ${succeeded} images. ${failed} failed.`);

            setSelectedIds(new Set());
            setSelectAll(false);
        } catch (error) {
            console.error('ZIP creation failed:', error);
            alert('Failed to create ZIP: ' + error.message);
        } finally {
            setIsDownloading(false);
        }
    };

    const clearSelection = () => {
        setSelectedIds(new Set());
        setSelectAll(false);
    };

    const openLightbox = (index) => setLightboxIndex(index);
    const getImageIndex = (imageId) => images.findIndex(img => img.id === imageId);

    const selectedCount = selectAll ? total : selectedIds.size;

    if (isLoading) {
        return (
            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].map((i) => (
                    <div key={i} className="animate-pulse">
                        <div className="aspect-square bg-[var(--color-bg-tertiary)] rounded-lg" />
                    </div>
                ))}
            </div>
        );
    }

    if (isError) {
        return (
            <div className="card border-[var(--color-error)] text-center py-8">
                <p className="text-[var(--color-error)]">Failed to load images</p>
            </div>
        );
    }

    if (images.length === 0) {
        return (
            <div className="empty-state py-12">
                <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <p className="mt-2">No images found</p>
                <p className="text-sm">Try adjusting your date filters or process some images first.</p>
            </div>
        );
    }

    return (
        <div>
            {/* Header with selection controls */}
            <div className="flex items-center justify-between mb-4 sticky top-0 bg-white py-2 z-10 border-b border-[var(--color-border-light)]">
                <div className="flex items-center gap-4">
                    <label className="flex items-center gap-2 cursor-pointer">
                        <input
                            type="checkbox"
                            checked={allSelected}
                            onChange={toggleSelectAll}
                            className="w-5 h-5 rounded border-2 border-[var(--color-border)] checked:bg-black checked:border-black cursor-pointer"
                        />
                        <span className="text-sm font-medium">Select All</span>
                    </label>
                    <span className="text-sm text-[var(--color-text-secondary)]">{total} images total</span>
                </div>

                <div className="flex items-center gap-3">
                    {selectedCount > 0 && (
                        <>
                            <span className="text-sm text-[var(--color-text-secondary)]">{selectedCount} selected</span>
                            <button onClick={clearSelection} className="text-sm text-[var(--color-text-secondary)] hover:text-black underline">Clear</button>
                        </>
                    )}
                    {selectedCount > 0 && (
                        <button onClick={handleDownloadAll} disabled={isDownloading} className="btn btn-primary flex items-center gap-2">
                            {isDownloading ? (
                                <>
                                    <svg className="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
                                    </svg>
                                    Creating ZIP...
                                </>
                            ) : (
                                <>
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    Download ({selectedCount})
                                </>
                            )}
                        </button>
                    )}
                </div>
            </div>

            {/* Grouped Images */}
            <div className="space-y-6">
                {Object.entries(groupedImages).sort((a, b) => b[0] - a[0]).map(([year, months]) => (
                    <div key={year} className="space-y-4">
                        <div className="flex items-center gap-2 border-b-2 border-black pb-2">
                            <input
                                type="checkbox"
                                checked={Object.values(months).flatMap(m => Object.values(m).flat()).every(img => selectedIds.has(img.id))}
                                onChange={() => toggleYearSelect(months)}
                                className="w-5 h-5 rounded border-2 border-[var(--color-border)] checked:bg-black checked:border-black cursor-pointer"
                            />
                            <h2 className="text-xl font-bold">{year}</h2>
                            <span className="text-sm text-[var(--color-text-secondary)]">({Object.values(months).flatMap(m => Object.values(m).flat()).length} images)</span>
                        </div>

                        {Object.entries(months).sort((a, b) => new Date(b[0]) - new Date(a[0])).map(([month, days]) => (
                            <div key={month} className="space-y-3 pl-4">
                                <div className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={Object.values(days).flat().every(img => selectedIds.has(img.id))}
                                        onChange={() => toggleMonthSelect(days)}
                                        className="w-4 h-4 rounded border-2 border-[var(--color-border)] checked:bg-black checked:border-black cursor-pointer"
                                    />
                                    <h3 className="text-lg font-semibold text-[var(--color-text-secondary)]">{month}</h3>
                                    <span className="text-xs text-[var(--color-text-muted)]">({Object.values(days).flat().length})</span>
                                </div>

                                {Object.entries(days).sort((a, b) => new Date(b[0]) - new Date(a[0])).map(([day, dayImages]) => (
                                    <div key={day} className="pl-4">
                                        <div className="flex items-center gap-2 mb-2">
                                            <input
                                                type="checkbox"
                                                checked={dayImages.every(img => selectedIds.has(img.id))}
                                                onChange={() => toggleDaySelect(dayImages)}
                                                className="w-4 h-4 rounded border-2 border-[var(--color-border)] checked:bg-black checked:border-black cursor-pointer"
                                            />
                                            <span className="text-sm font-medium">{day}</span>
                                            <span className="text-xs text-[var(--color-text-muted)]">({dayImages.length} images)</span>
                                        </div>

                                        <div className="grid grid-cols-3 md:grid-cols-5 lg:grid-cols-8 gap-2">
                                            {dayImages.map((image) => {
                                                const isSelected = selectedIds.has(image.id);
                                                const flatIndex = getImageIndex(image.id);

                                                return (
                                                    <div
                                                        key={image.id}
                                                        className={`relative group cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${isSelected ? 'border-black ring-2 ring-black/20' : 'border-transparent hover:border-[var(--color-border)]'}`}
                                                    >
                                                        <div
                                                            className={`absolute top-1 left-1 z-10 ${isSelected || 'opacity-0 group-hover:opacity-100'} transition-opacity`}
                                                            onClick={(e) => { e.stopPropagation(); toggleSelect(image.id); }}
                                                        >
                                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${isSelected ? 'bg-black border-black text-white' : 'bg-white/90 border-white shadow'}`}>
                                                                {isSelected && (
                                                                    <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                                        <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                                                                    </svg>
                                                                )}
                                                            </div>
                                                        </div>

                                                        <div className="aspect-square bg-[var(--color-bg-secondary)]" onClick={() => openLightbox(flatIndex)}>
                                                            <img
                                                                src={image.url}
                                                                alt={image.filename}
                                                                className="w-full h-full object-cover"
                                                                loading="lazy"
                                                                onError={(e) => {
                                                                    e.target.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23999" stroke-width="1"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>';
                                                                }}
                                                            />
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ))}
                    </div>
                ))}
            </div>

            {/* Pagination */}
            <div className="flex items-center justify-between mt-6 pt-4 border-t border-[var(--color-border-light)]">
                <div className="text-sm text-[var(--color-text-secondary)]">
                    Showing {(page - 1) * pageSize + 1} - {Math.min(page * pageSize, total)} of {total}
                </div>
                <div className="flex gap-2">
                    <button onClick={() => setPage((p) => Math.max(1, p - 1))} disabled={page === 1} className="btn btn-secondary">Previous</button>
                    <button onClick={() => setPage((p) => p + 1)} disabled={!hasMore} className="btn btn-secondary">Next</button>
                </div>
            </div>

            {/* Lightbox */}
            {lightboxIndex !== null && (
                <ImageLightbox
                    image={images[lightboxIndex]}
                    onClose={() => setLightboxIndex(null)}
                    onPrev={() => setLightboxIndex(i => Math.max(0, i - 1))}
                    onNext={() => setLightboxIndex(i => Math.min(images.length - 1, i + 1))}
                    hasPrev={lightboxIndex > 0}
                    hasNext={lightboxIndex < images.length - 1}
                />
            )}
        </div>
    );
}
</file>

<file path="src/components/ImageLightbox.jsx">
/**
 * ImageLightbox Component
 * Modal for viewing images in full size (Shopee-style overlay).
 */

import { useEffect } from 'react';
import { formatFileSize, formatDimensions, formatDateTime } from '../utils/formatters';

export default function ImageLightbox({ image, onClose, onPrev, onNext, hasPrev, hasNext }) {
    // Handle keyboard navigation
    useEffect(() => {
        const handleKeyDown = (e) => {
            if (e.key === 'Escape') onClose();
            if (e.key === 'ArrowLeft' && hasPrev) onPrev();
            if (e.key === 'ArrowRight' && hasNext) onNext();
        };

        window.addEventListener('keydown', handleKeyDown);
        document.body.style.overflow = 'hidden';

        return () => {
            window.removeEventListener('keydown', handleKeyDown);
            document.body.style.overflow = '';
        };
    }, [onClose, onPrev, onNext, hasPrev, hasNext]);

    if (!image) return null;

    const handleDownload = async () => {
        try {
            // Use backend proxy to avoid CORS
            const response = await fetch(`/api/images/${image.id}/download`);
            if (!response.ok) throw new Error('Download failed');
            const blob = await response.blob();
            const blobUrl = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = blobUrl;
            link.download = image.filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(blobUrl);
        } catch (error) {
            console.error('Download failed:', error);
            // Fallback to opening URL in new tab
            window.open(image.url, '_blank');
        }
    };

    return (
        <div
            className="fixed inset-0 z-50 flex items-center justify-center"
            style={{ backgroundColor: 'rgba(0, 0, 0, 0.9)' }}
        >
            {/* Close button */}
            <button
                onClick={onClose}
                className="absolute top-4 right-4 p-2 text-white hover:bg-white/20 rounded-full transition-colors z-10"
            >
                <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            {/* Download button */}
            <button
                onClick={handleDownload}
                className="absolute top-4 right-16 p-2 text-white hover:bg-white/20 rounded-full transition-colors z-10"
                title="Download"
            >
                <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
            </button>

            {/* Previous button */}
            {hasPrev && (
                <button
                    onClick={onPrev}
                    className="absolute left-4 top-1/2 -translate-y-1/2 p-3 text-white hover:bg-white/20 rounded-full transition-colors"
                >
                    <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
            )}

            {/* Next button */}
            {hasNext && (
                <button
                    onClick={onNext}
                    className="absolute right-4 top-1/2 -translate-y-1/2 p-3 text-white hover:bg-white/20 rounded-full transition-colors"
                >
                    <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                    </svg>
                </button>
            )}

            {/* Image container */}
            <div className="max-w-[90vw] max-h-[85vh] flex flex-col">
                <img
                    src={image.url}
                    alt={image.filename}
                    className="max-w-full max-h-[70vh] object-contain"
                    onClick={(e) => e.stopPropagation()}
                />

                {/* Image info */}
                <div className="mt-4 text-white text-center">
                    <div className="font-medium text-lg">{image.filename}</div>
                    <div className="text-white/70 text-sm mt-1 flex justify-center gap-4">
                        <span>{formatDimensions(image.width, image.height)}</span>
                        <span>•</span>
                        <span>{formatFileSize(image.size_bytes)}</span>
                        <span>•</span>
                        <span>{formatDateTime(image.created_at)}</span>
                    </div>
                </div>
            </div>

            {/* Click outside to close */}
            <div
                className="absolute inset-0 -z-10"
                onClick={onClose}
            />
        </div>
    );
}
</file>

<file path="src/components/ImagePreview.jsx">
/**
 * ImagePreview Component
 * Auto-processes queue and displays images with history scroller.
 */

import { useState, useEffect, useRef } from 'react';
import { usePopFromQueue } from '../hooks/useImages';
import { useStatus } from '../hooks/useStatus';
import { formatFileSize, formatDimensions, formatRelativeTime } from '../utils/formatters';

export default function ImagePreview() {
    const { data: status } = useStatus({ refetchInterval: 500 });
    const popMutation = usePopFromQueue();

    const [currentImage, setCurrentImage] = useState(null);
    const [imageHistory, setImageHistory] = useState([]);
    const [isProcessing, setIsProcessing] = useState(false);
    const historyRef = useRef(null);

    const queueSize = status?.queue?.current_size ?? 0;

    // Auto-pop from queue when items are available
    useEffect(() => {
        const processQueue = async () => {
            if (queueSize > 0 && !isProcessing && !popMutation.isPending) {
                setIsProcessing(true);
                try {
                    const result = await popMutation.mutateAsync();
                    if (result.success && result.image) {
                        // Update current image
                        setCurrentImage(result.image);

                        // Add to history (newest first)
                        setImageHistory(prev => {
                            const newHistory = [result.image, ...prev];
                            // Keep max 50 items in history
                            return newHistory.slice(0, 50);
                        });
                    }
                } catch (error) {
                    console.error('Auto-pop failed:', error);
                } finally {
                    setIsProcessing(false);
                }
            }
        };

        processQueue();
    }, [queueSize, isProcessing, popMutation.isPending]);

    // Auto-scroll history to top when new image added
    useEffect(() => {
        if (historyRef.current) {
            historyRef.current.scrollTop = 0;
        }
    }, [imageHistory.length]);

    const displayImage = currentImage || status?.last_image;

    return (
        <div className="card">
            <div className="flex items-center justify-between mb-4">
                <h3 className="text-sm font-medium text-[var(--color-text-secondary)] uppercase tracking-wider">
                    Auto-Processing Queue
                </h3>
                <div className="flex items-center gap-3">
                    {/* Processing indicator */}
                    {(isProcessing || popMutation.isPending) && (
                        <div className="flex items-center gap-2 text-sm text-[var(--color-info)]">
                            <svg className="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
                            </svg>
                            Processing...
                        </div>
                    )}

                    {/* Queue size badge */}
                    <span className={`badge ${queueSize > 0 ? 'badge-info' : ''}`}>
                        Queue: {queueSize}
                    </span>

                    {/* History count */}
                    <span className="badge">
                        History: {imageHistory.length}
                    </span>
                </div>
            </div>

            {/* Main content with image preview and history scroller */}
            <div className="flex gap-4">
                {/* Main image display */}
                <div className="flex-1">
                    {displayImage ? (
                        <div className="space-y-4">
                            {/* Image Preview */}
                            <div className="relative aspect-video bg-[var(--color-bg-secondary)] rounded-lg overflow-hidden">
                                <img
                                    src={displayImage.url}
                                    alt={displayImage.filename}
                                    className="w-full h-full object-contain"
                                    onError={(e) => {
                                        e.target.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23999" stroke-width="1"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>';
                                    }}
                                />

                                {/* Live indicator */}
                                {(isProcessing || popMutation.isPending) && (
                                    <div className="absolute top-3 right-3 flex items-center gap-2 bg-black/70 text-white px-2 py-1 rounded text-xs">
                                        <span className="status-dot animate-pulse" style={{ background: '#22c55e' }} />
                                        LIVE
                                    </div>
                                )}
                            </div>

                            {/* Image Info */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div>
                                    <div className="text-[var(--color-text-muted)]">Filename</div>
                                    <div className="font-medium truncate" title={displayImage.filename}>
                                        {displayImage.filename}
                                    </div>
                                </div>
                                <div>
                                    <div className="text-[var(--color-text-muted)]">Dimensions</div>
                                    <div className="font-medium">
                                        {formatDimensions(displayImage.width, displayImage.height) || 'N/A'}
                                    </div>
                                </div>
                                <div>
                                    <div className="text-[var(--color-text-muted)]">Size</div>
                                    <div className="font-medium">
                                        {formatFileSize(displayImage.size_bytes) || 'N/A'}
                                    </div>
                                </div>
                                <div>
                                    <div className="text-[var(--color-text-muted)]">Processed</div>
                                    <div className="font-medium">
                                        {formatRelativeTime(displayImage.timestamp || displayImage.created_at)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="empty-state py-12">
                            <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <p className="mt-2">Waiting for images...</p>
                            <p className="text-sm">
                                Load images from the desktop GUI to auto-process.
                            </p>
                        </div>
                    )}
                </div>

                {/* Image History Scroller (Right side) */}
                <div className="w-48 flex-shrink-0">
                    <div className="text-xs font-medium text-[var(--color-text-secondary)] uppercase tracking-wider mb-2">
                        Recent Images
                    </div>
                    <div
                        ref={historyRef}
                        className="overflow-y-auto bg-[var(--color-bg-secondary)] rounded-lg"
                        style={{ height: '400px' }}
                    >
                        {imageHistory.length > 0 ? (
                            <div className="p-2 space-y-2">
                                {imageHistory.map((img, index) => (
                                    <div
                                        key={img.id || index}
                                        className={`cursor-pointer rounded overflow-hidden border-2 transition-all ${currentImage?.id === img.id
                                                ? 'border-black'
                                                : 'border-transparent hover:border-[var(--color-border)]'
                                            }`}
                                        onClick={() => setCurrentImage(img)}
                                    >
                                        <div className="aspect-video bg-[var(--color-bg-tertiary)] relative">
                                            <img
                                                src={img.url}
                                                alt={img.filename}
                                                className="w-full h-full object-cover"
                                                loading="lazy"
                                                onError={(e) => {
                                                    e.target.style.display = 'none';
                                                }}
                                            />
                                            {index === 0 && (
                                                <div className="absolute top-1 left-1 bg-[var(--color-success)] text-white text-[10px] px-1 rounded">
                                                    NEW
                                                </div>
                                            )}
                                        </div>
                                        <div className="p-1.5 bg-white">
                                            <div className="text-[10px] font-medium truncate">
                                                {img.filename}
                                            </div>
                                            <div className="text-[9px] text-[var(--color-text-muted)]">
                                                {formatDimensions(img.width, img.height)}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="flex items-center justify-center h-full text-[var(--color-text-muted)] text-xs">
                                No images yet
                            </div>
                        )}
                    </div>
                </div>
            </div>

            {/* Error Display */}
            {popMutation.isError && (
                <div className="mt-4 p-3 bg-[#fee2e2] text-[#991b1b] rounded text-sm">
                    Error: {popMutation.error?.message || 'Failed to process image'}
                </div>
            )}
        </div>
    );
}
</file>

<file path="src/components/Layout.jsx">
/**
 * Layout Component
 * Main layout wrapper with navigation and content area.
 */

import { Outlet } from 'react-router-dom';
import Navbar from './Navbar';

export default function Layout() {
    return (
        <div className="min-h-screen bg-white">
            <Navbar />
            <main className="container py-6">
                <Outlet />
            </main>
        </div>
    );
}
</file>

<file path="src/components/LogPanel.jsx">
/**
 * LogPanel Component
 * Real-time log display panel with auto-scroll.
 */

import { useRef, useEffect } from 'react';
import { useLatestLogs } from '../hooks/useLogs';
import { formatLogTime } from '../utils/formatters';

export default function LogPanel({ type = 'activity', title = 'Activity Logs', maxHeight = '300px' }) {
    const { data, isLoading } = useLatestLogs();
    const scrollRef = useRef(null);

    // Get logs based on type
    const logs = type === 'activity' ? data?.activity : data?.server;

    // Auto-scroll to bottom when new logs arrive
    useEffect(() => {
        if (scrollRef.current) {
            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
        }
    }, [logs]);

    const getLevelClass = (level) => {
        switch (level?.toLowerCase()) {
            case 'debug': return 'log-debug';
            case 'info': return 'log-info';
            case 'warning': return 'log-warning';
            case 'error': return 'log-error';
            case 'critical': return 'log-critical';
            default: return '';
        }
    };

    const getLevelBadge = (level) => {
        switch (level?.toLowerCase()) {
            case 'debug': return 'badge';
            case 'info': return 'badge badge-info';
            case 'warning': return 'badge badge-warning';
            case 'error': return 'badge badge-error';
            case 'critical': return 'badge badge-error';
            default: return 'badge';
        }
    };

    return (
        <div className="card">
            <div className="flex items-center justify-between mb-3">
                <h3 className="text-sm font-medium text-[var(--color-text-secondary)] uppercase tracking-wider">
                    {title}
                </h3>
                <span className="text-xs text-[var(--color-text-muted)]">
                    {logs?.length ?? 0} entries
                </span>
            </div>

            <div
                ref={scrollRef}
                className="overflow-y-auto font-mono text-xs bg-[var(--color-bg-secondary)] rounded-lg p-3"
                style={{ maxHeight }}
            >
                {isLoading ? (
                    <div className="animate-pulse space-y-2">
                        {[1, 2, 3].map((i) => (
                            <div key={i} className="h-4 bg-[var(--color-bg-tertiary)] rounded w-full" />
                        ))}
                    </div>
                ) : logs && logs.length > 0 ? (
                    <div className="space-y-1">
                        {logs.map((log, index) => (
                            <div key={index} className="flex items-start gap-2 py-1 border-b border-[var(--color-border-light)] last:border-0">
                                <span className="text-[var(--color-text-muted)] flex-shrink-0">
                                    {formatLogTime(log.timestamp || log.created_at)}
                                </span>
                                {log.level && (
                                    <span className={`${getLevelBadge(log.level)} flex-shrink-0`}>
                                        {log.level.toUpperCase()}
                                    </span>
                                )}
                                <span className={`${getLevelClass(log.level)} break-all`}>
                                    {log.message || log.action || JSON.stringify(log)}
                                </span>
                            </div>
                        ))}
                    </div>
                ) : (
                    <div className="text-center text-[var(--color-text-muted)] py-4">
                        No logs yet
                    </div>
                )}
            </div>
        </div>
    );
}
</file>

<file path="src/components/LogTable.jsx">
/**
 * LogTable Component
 * Tabular display of logs with filtering, pagination, and CSV export.
 */

import { useState } from 'react';
import { useLogs } from '../hooks/useLogs';
import { formatDateTime } from '../utils/formatters';

export default function LogTable({ startDate, endDate, logType, logLevel }) {
    const [page, setPage] = useState(1);
    const pageSize = 25;

    const { data, isLoading, isError } = useLogs({
        start_date: startDate,
        end_date: endDate,
        log_type: logType,
        level: logLevel,
        page,
        page_size: pageSize,
    });

    const getLevelBadge = (level) => {
        switch (level?.toLowerCase()) {
            case 'debug': return 'badge';
            case 'info': return 'badge badge-info';
            case 'warning': return 'badge badge-warning';
            case 'error': return 'badge badge-error';
            case 'critical': return 'badge badge-error';
            default: return 'badge';
        }
    };

    const getTypeBadge = (type) => {
        switch (type?.toLowerCase()) {
            case 'activity': return 'badge badge-success';
            case 'server': return 'badge badge-info';
            case 'error': return 'badge badge-error';
            default: return 'badge';
        }
    };

    const handleExportCSV = () => {
        const logs = data?.items ?? [];
        if (logs.length === 0) return;

        // CSV header
        const headers = ['Timestamp', 'Type', 'Level', 'Message', 'Source'];

        // CSV rows
        const rows = logs.map(log => [
            formatDateTime(log.created_at),
            log.type || '',
            log.level || '',
            `"${(log.message || '').replace(/"/g, '""')}"`, // Escape quotes in message
            log.source || '',
        ]);

        // Build CSV content
        const csvContent = [
            headers.join(','),
            ...rows.map(row => row.join(','))
        ].join('\n');

        // Download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `logs_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        window.URL.revokeObjectURL(url);
    };

    if (isLoading) {
        return (
            <div className="card animate-pulse">
                <div className="space-y-3">
                    {[1, 2, 3, 4, 5].map((i) => (
                        <div key={i} className="h-8 bg-[var(--color-bg-tertiary)] rounded" />
                    ))}
                </div>
            </div>
        );
    }

    if (isError) {
        return (
            <div className="card border-[var(--color-error)] text-center py-8">
                <p className="text-[var(--color-error)]">Failed to load logs</p>
            </div>
        );
    }

    const logs = data?.items ?? [];
    const total = data?.total ?? 0;
    const hasMore = data?.has_more ?? false;

    if (logs.length === 0) {
        return (
            <div className="empty-state py-12">
                <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <p className="mt-2">No logs found</p>
                <p className="text-sm">Try adjusting your filters or wait for new log entries.</p>
            </div>
        );
    }

    return (
        <div>
            {/* Header with Export button */}
            <div className="flex items-center justify-between mb-4">
                <div className="text-sm text-[var(--color-text-secondary)]">
                    {total} log entries
                </div>
                <button
                    onClick={handleExportCSV}
                    className="btn btn-secondary flex items-center gap-2"
                >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Export CSV
                </button>
            </div>

            {/* Table */}
            <div className="overflow-x-auto">
                <table className="table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Type</th>
                            <th>Level</th>
                            <th>Message</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody>
                        {logs.map((log) => (
                            <tr key={log.id}>
                                <td className="text-sm text-[var(--color-text-secondary)] whitespace-nowrap">
                                    {formatDateTime(log.created_at)}
                                </td>
                                <td>
                                    <span className={getTypeBadge(log.type)}>{log.type}</span>
                                </td>
                                <td>
                                    <span className={getLevelBadge(log.level)}>{log.level}</span>
                                </td>
                                <td className="max-w-md truncate" title={log.message}>
                                    {log.message}
                                </td>
                                <td className="text-sm text-[var(--color-text-muted)]">
                                    {log.source || '-'}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            {/* Pagination */}
            <div className="flex items-center justify-between mt-4 pt-4 border-t border-[var(--color-border-light)]">
                <div className="text-sm text-[var(--color-text-secondary)]">
                    Showing {(page - 1) * pageSize + 1} - {Math.min(page * pageSize, total)} of {total}
                </div>
                <div className="flex gap-2">
                    <button
                        onClick={() => setPage((p) => Math.max(1, p - 1))}
                        disabled={page === 1}
                        className="btn btn-secondary"
                    >
                        Previous
                    </button>
                    <button
                        onClick={() => setPage((p) => p + 1)}
                        disabled={!hasMore}
                        className="btn btn-secondary"
                    >
                        Next
                    </button>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/components/Navbar.jsx">
/**
 * Navbar Component
 * Navigation tabs for the main sections of the app.
 */

import { NavLink } from 'react-router-dom';
import { useHealthCheck } from '../hooks/useStatus';

export default function Navbar() {
    const { data: health, isError } = useHealthCheck();

    const isConnected = health?.status === 'ok';

    return (
        <nav className="border-b border-[var(--color-border)] bg-white sticky top-0 z-50">
            <div className="container">
                <div className="flex items-center justify-between h-16">
                    {/* Logo */}
                    <div className="flex items-center gap-3">
                        <div className="w-8 h-8 bg-black rounded flex items-center justify-center">
                            <span className="text-white font-bold text-sm">IP</span>
                        </div>
                        <span className="font-semibold text-lg tracking-tight">Image Processor</span>
                    </div>

                    {/* Navigation Links */}
                    <div className="flex items-center gap-1">
                        <NavLink
                            to="/"
                            className={({ isActive }) =>
                                `px-4 py-2 text-sm font-medium rounded transition-colors ${isActive
                                    ? 'bg-black text-white'
                                    : 'text-[var(--color-text-secondary)] hover:text-black hover:bg-[var(--color-bg-secondary)]'
                                }`
                            }
                        >
                            Dashboard
                        </NavLink>
                        <NavLink
                            to="/history"
                            className={({ isActive }) =>
                                `px-4 py-2 text-sm font-medium rounded transition-colors ${isActive
                                    ? 'bg-black text-white'
                                    : 'text-[var(--color-text-secondary)] hover:text-black hover:bg-[var(--color-bg-secondary)]'
                                }`
                            }
                        >
                            History
                        </NavLink>
                        <NavLink
                            to="/system"
                            className={({ isActive }) =>
                                `px-4 py-2 text-sm font-medium rounded transition-colors ${isActive
                                    ? 'bg-black text-white'
                                    : 'text-[var(--color-text-secondary)] hover:text-black hover:bg-[var(--color-bg-secondary)]'
                                }`
                            }
                        >
                            System
                        </NavLink>
                    </div>

                    {/* Connection Status */}
                    <div className="flex items-center gap-2">
                        <span
                            className={`status-dot ${isConnected ? 'success' : isError ? 'error' : 'warning'}`}
                        />
                        <span className="text-sm text-[var(--color-text-secondary)]">
                            {isConnected ? 'Connected' : isError ? 'Disconnected' : 'Connecting...'}
                        </span>
                    </div>
                </div>
            </div>
        </nav>
    );
}
</file>

<file path="src/components/StatusCard.jsx">
/**
 * StatusCard Component
 * Displays queue status and server information.
 */

import { useStatus } from '../hooks/useStatus';
import { formatRelativeTime } from '../utils/formatters';

export default function StatusCard() {
    const { data, isLoading, isError } = useStatus();

    if (isLoading) {
        return (
            <div className="card animate-pulse">
                <div className="h-4 bg-[var(--color-bg-tertiary)] rounded w-1/3 mb-4"></div>
                <div className="h-8 bg-[var(--color-bg-tertiary)] rounded w-1/2"></div>
            </div>
        );
    }

    if (isError) {
        return (
            <div className="card border-[var(--color-error)]">
                <div className="flex items-center gap-2 text-[var(--color-error)]">
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span className="font-medium">Connection Error</span>
                </div>
                <p className="text-sm text-[var(--color-text-secondary)] mt-2">
                    Unable to connect to the backend server.
                </p>
            </div>
        );
    }

    const queue = data?.queue || {};
    const system = data?.system || {};

    return (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            {/* Queue Status */}
            <div className="card">
                <div className="flex items-center justify-between mb-2">
                    <h3 className="text-sm font-medium text-[var(--color-text-secondary)] uppercase tracking-wider">
                        Queue
                    </h3>
                    <span className={`badge ${queue.current_size > 0 ? 'badge-info' : ''}`}>
                        {queue.is_full ? 'Full' : queue.is_empty ? 'Empty' : 'Active'}
                    </span>
                </div>
                <div className="text-4xl font-bold mb-1">
                    {queue.current_size ?? 0}
                </div>
                <div className="text-sm text-[var(--color-text-secondary)]">
                    of {queue.max_size ?? 100} capacity
                </div>
                <div className="mt-4 pt-4 border-t border-[var(--color-border-light)] grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <div className="text-[var(--color-text-muted)]">Pushed</div>
                        <div className="font-medium">{queue.total_pushed ?? 0}</div>
                    </div>
                    <div>
                        <div className="text-[var(--color-text-muted)]">Popped</div>
                        <div className="font-medium">{queue.total_popped ?? 0}</div>
                    </div>
                </div>
            </div>

            {/* System Status */}
            <div className="card">
                <h3 className="text-sm font-medium text-[var(--color-text-secondary)] uppercase tracking-wider mb-2">
                    System
                </h3>
                <div className="space-y-3">
                    <div className="flex justify-between items-center">
                        <span className="text-[var(--color-text-secondary)]">Memory</span>
                        <span className="font-medium">{system.memory_mb ?? 0} MB</span>
                    </div>
                    <div className="flex justify-between items-center">
                        <span className="text-[var(--color-text-secondary)]">CPU</span>
                        <span className="font-medium">{system.cpu_percent ?? 0}%</span>
                    </div>
                    <div className="flex justify-between items-center">
                        <span className="text-[var(--color-text-secondary)]">Threads</span>
                        <span className="font-medium">{system.threads ?? 0}</span>
                    </div>
                </div>
            </div>

            {/* Uptime */}
            <div className="card">
                <h3 className="text-sm font-medium text-[var(--color-text-secondary)] uppercase tracking-wider mb-2">
                    Server Uptime
                </h3>
                <div className="text-4xl font-bold mb-1">
                    {Math.floor((data?.uptime_seconds ?? 0) / 60)}
                    <span className="text-lg font-normal text-[var(--color-text-secondary)]">min</span>
                </div>
                <div className="text-sm text-[var(--color-text-secondary)]">
                    Last push: {formatRelativeTime(queue.last_push_time)}
                </div>
                <div className="text-sm text-[var(--color-text-secondary)]">
                    Last pop: {formatRelativeTime(queue.last_pop_time)}
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/hooks/useImages.js">
/**
 * Custom hooks for images API using TanStack Query
 */

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { imagesApi } from '../lib/api';

/**
 * Hook for listing images with filters
 */
export function useImages(params = {}, options = {}) {
    return useQuery({
        queryKey: ['images', params],
        queryFn: async () => {
            const { data } = await imagesApi.listImages(params);
            return data;
        },
        staleTime: 30000,
        ...options,
    });
}

/**
 * Hook for getting a single image
 */
export function useImage(id, options = {}) {
    return useQuery({
        queryKey: ['image', id],
        queryFn: async () => {
            const { data } = await imagesApi.getImage(id);
            return data;
        },
        enabled: !!id,
        ...options,
    });
}

/**
 * Hook for popping image from queue
 */
export function usePopFromQueue() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: async () => {
            const { data } = await imagesApi.popFromQueue();
            return data;
        },
        onSuccess: (data) => {
            // Invalidate related queries
            queryClient.invalidateQueries({ queryKey: ['status'] });
            queryClient.invalidateQueries({ queryKey: ['queue-status'] });
            queryClient.invalidateQueries({ queryKey: ['images'] });
            queryClient.invalidateQueries({ queryKey: ['logs'] });
        },
    });
}

/**
 * Hook for deleting an image
 */
export function useDeleteImage() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: async (id) => {
            const { data } = await imagesApi.deleteImage(id);
            return data;
        },
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['images'] });
            queryClient.invalidateQueries({ queryKey: ['logs'] });
        },
    });
}
</file>

<file path="src/hooks/useLogs.js">
/**
 * Custom hooks for logs API using TanStack Query
 */

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { logsApi } from '../lib/api';

/**
 * Hook for fetching latest logs (from KV hot storage)
 */
export function useLatestLogs(options = {}) {
    return useQuery({
        queryKey: ['logs', 'latest'],
        queryFn: async () => {
            const { data } = await logsApi.getLatestLogs();
            return data;
        },
        refetchInterval: options.refetchInterval ?? 2000,
        staleTime: 1000,
        ...options,
    });
}

/**
 * Hook for fetching activity logs only
 */
export function useActivityLogs(options = {}) {
    return useQuery({
        queryKey: ['logs', 'activity'],
        queryFn: async () => {
            const { data } = await logsApi.getActivityLogs();
            return data;
        },
        refetchInterval: options.refetchInterval ?? 2000,
        staleTime: 1000,
        ...options,
    });
}

/**
 * Hook for fetching server logs only
 */
export function useServerLogs(options = {}) {
    return useQuery({
        queryKey: ['logs', 'server'],
        queryFn: async () => {
            const { data } = await logsApi.getServerLogs();
            return data;
        },
        refetchInterval: options.refetchInterval ?? 2000,
        staleTime: 1000,
        ...options,
    });
}

/**
 * Hook for listing logs from D1 with filters
 */
export function useLogs(params = {}, options = {}) {
    return useQuery({
        queryKey: ['logs', 'history', params],
        queryFn: async () => {
            const { data } = await logsApi.listLogs(params);
            return data;
        },
        staleTime: 30000,
        ...options,
    });
}

/**
 * Hook for cleaning up old logs
 */
export function useCleanupLogs() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: async (days = 90) => {
            const { data } = await logsApi.cleanupLogs(days);
            return data;
        },
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['logs'] });
        },
    });
}

/**
 * Hook for clearing hot logs
 */
export function useClearHotLogs() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: async (logType) => {
            const { data } = await logsApi.clearHotLogs(logType);
            return data;
        },
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['logs', 'latest'] });
            queryClient.invalidateQueries({ queryKey: ['logs', 'activity'] });
            queryClient.invalidateQueries({ queryKey: ['logs', 'server'] });
        },
    });
}
</file>

<file path="src/hooks/useStatus.js">
/**
 * Custom hooks for API data fetching using TanStack Query
 */

import { useQuery } from '@tanstack/react-query';
import { statusApi } from '../lib/api';

/**
 * Hook for fetching server status with polling
 */
export function useStatus(options = {}) {
    return useQuery({
        queryKey: ['status'],
        queryFn: async () => {
            const { data } = await statusApi.getStatus();
            return data;
        },
        refetchInterval: options.refetchInterval ?? 2000,
        staleTime: 1000,
        ...options,
    });
}

/**
 * Hook for fetching queue status only
 */
export function useQueueStatus(options = {}) {
    return useQuery({
        queryKey: ['queue-status'],
        queryFn: async () => {
            const { data } = await statusApi.getQueueStatus();
            return data;
        },
        refetchInterval: options.refetchInterval ?? 2000,
        staleTime: 1000,
        ...options,
    });
}

/**
 * Hook for health check
 */
export function useHealthCheck(options = {}) {
    return useQuery({
        queryKey: ['health'],
        queryFn: async () => {
            const { data } = await statusApi.getHealth();
            return data;
        },
        refetchInterval: options.refetchInterval ?? 5000,
        retry: 1,
        ...options,
    });
}
</file>

<file path="src/index.css">
@import "tailwindcss";

/* ============================================
   Swiss Minimalist Design System
   - White background
   - Black typography
   - Light borders
   - High whitespace
   ============================================ */

/* Base Styles */
:root {
  /* Colors */
  --color-bg: #ffffff;
  --color-bg-secondary: #fafafa;
  --color-bg-tertiary: #f5f5f5;
  --color-text: #1a1a1a;
  --color-text-secondary: #666666;
  --color-text-muted: #999999;
  --color-border: #e5e5e5;
  --color-border-light: #f0f0f0;
  
  /* Status Colors */
  --color-success: #22c55e;
  --color-warning: #f59e0b;
  --color-error: #ef4444;
  --color-info: #3b82f6;
  
  /* Spacing */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  
  /* Typography */
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
  
  /* Border Radius */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: var(--font-sans);
  background-color: var(--color-bg);
  color: var(--color-text);
  line-height: 1.6;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: 1.3;
  letter-spacing: -0.02em;
}

h1 { font-size: 2rem; }
h2 { font-size: 1.5rem; }
h3 { font-size: 1.25rem; }
h4 { font-size: 1rem; }

/* Utility Classes */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--space-xl);
}

.card {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-lg);
}

.card-hover:hover {
  border-color: var(--color-text);
  transition: border-color 0.2s ease;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  font-size: 0.875rem;
  font-weight: 500;
  border-radius: var(--radius-sm);
  border: 1px solid transparent;
  cursor: pointer;
  transition: all 0.15s ease;
}

.btn-primary {
  background: var(--color-text);
  color: var(--color-bg);
  border-color: var(--color-text);
}

.btn-primary:hover {
  background: #333333;
}

.btn-secondary {
  background: var(--color-bg);
  color: var(--color-text);
  border-color: var(--color-border);
}

.btn-secondary:hover {
  border-color: var(--color-text);
}

.btn-danger {
  background: var(--color-error);
  color: white;
  border-color: var(--color-error);
}

.btn-danger:hover {
  background: #dc2626;
}

/* Status Indicators */
.status-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: var(--space-sm);
}

.status-dot.success { background: var(--color-success); }
.status-dot.warning { background: var(--color-warning); }
.status-dot.error { background: var(--color-error); }
.status-dot.info { background: var(--color-info); }

/* Log Levels */
.log-debug { color: var(--color-text-muted); }
.log-info { color: var(--color-info); }
.log-warning { color: var(--color-warning); }
.log-error { color: var(--color-error); }
.log-critical { color: var(--color-error); font-weight: 600; }

/* Tables */
.table {
  width: 100%;
  border-collapse: collapse;
}

.table th,
.table td {
  padding: var(--space-sm) var(--space-md);
  text-align: left;
  border-bottom: 1px solid var(--color-border-light);
}

.table th {
  font-weight: 600;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-secondary);
}

.table tr:hover {
  background: var(--color-bg-secondary);
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: var(--color-bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-muted);
}

/* Animations */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
.animate-spin { animation: spin 1s linear infinite; }

/* Form Elements */
input, select {
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-size: 0.875rem;
  background: var(--color-bg);
  color: var(--color-text);
  transition: border-color 0.15s ease;
}

input:focus, select:focus {
  outline: none;
  border-color: var(--color-text);
}

input::placeholder {
  color: var(--color-text-muted);
}

/* Badge */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 2px 8px;
  font-size: 0.75rem;
  font-weight: 500;
  border-radius: 9999px;
  background: var(--color-bg-tertiary);
  color: var(--color-text-secondary);
}

.badge-success { background: #dcfce7; color: #166534; }
.badge-warning { background: #fef3c7; color: #92400e; }
.badge-error { background: #fee2e2; color: #991b1b; }
.badge-info { background: #dbeafe; color: #1e40af; }

/* Empty State */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-2xl);
  color: var(--color-text-muted);
  text-align: center;
}

.empty-state svg {
  width: 48px;
  height: 48px;
  margin-bottom: var(--space-md);
  opacity: 0.5;
}
</file>

<file path="src/lib/api.js">
/**
 * API Client Configuration
 * Centralized API client using axios with base URL and interceptors.
 */

import axios from 'axios';

// Create axios instance with base configuration
const api = axios.create({
    baseURL: '/api',
    timeout: 30000,
    headers: {
        'Content-Type': 'application/json',
    },
});

// Request interceptor for logging
api.interceptors.request.use(
    (config) => {
        console.log(`[API] ${config.method?.toUpperCase()} ${config.url}`);
        return config;
    },
    (error) => {
        console.error('[API] Request error:', error);
        return Promise.reject(error);
    }
);

// Response interceptor for error handling
api.interceptors.response.use(
    (response) => {
        return response;
    },
    (error) => {
        console.error('[API] Response error:', error.response?.data || error.message);
        return Promise.reject(error);
    }
);

// API functions
export const statusApi = {
    getStatus: () => api.get('/status'),
    getHealth: () => api.get('/status/health'),
    getQueueStatus: () => api.get('/status/queue'),
};

export const imagesApi = {
    popFromQueue: () => api.get('/images/from-queue'),
    listImages: (params) => api.get('/images', { params }),
    getImage: (id) => api.get(`/images/${id}`),
    getImageUrl: (id, expiration = 3600) => api.get(`/images/${id}/url`, { params: { expiration } }),
    deleteImage: (id) => api.delete(`/images/${id}`),
};

export const logsApi = {
    getLatestLogs: () => api.get('/logs/latest'),
    getActivityLogs: () => api.get('/logs/activity'),
    getServerLogs: () => api.get('/logs/server'),
    listLogs: (params) => api.get('/logs', { params }),
    cleanupLogs: (days = 90) => api.delete('/logs/cleanup', { params: { days } }),
    clearHotLogs: (logType) => api.post('/logs/clear-hot', null, { params: { log_type: logType } }),
};

export default api;
</file>

<file path="src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="src/pages/Dashboard.jsx">
/**
 * Dashboard Page
 * Main dashboard with queue status, last image, and real-time logs.
 */

import StatusCard from '../components/StatusCard';
import ImagePreview from '../components/ImagePreview';
import LogPanel from '../components/LogPanel';

export default function Dashboard() {
    return (
        <div className="space-y-6">
            {/* Page Header */}
            <div>
                <h1 className="text-2xl font-bold">Dashboard</h1>
                <p className="text-[var(--color-text-secondary)] mt-1">
                    Real-time monitoring of the image processing system
                </p>
            </div>

            {/* Status Cards */}
            <StatusCard />

            {/* Image Preview */}
            <ImagePreview />

            {/* Log Panels */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <LogPanel type="activity" title="Activity Logs" maxHeight="350px" />
                <LogPanel type="server" title="Server Logs" maxHeight="350px" />
            </div>
        </div>
    );
}
</file>

<file path="src/pages/History.jsx">
/**
 * History Page
 * History of processed images and logs with filtering.
 */

import { useState } from 'react';
import FilterBar from '../components/FilterBar';
import ImageGrid from '../components/ImageGrid';
import LogTable from '../components/LogTable';

export default function History() {
    const [activeTab, setActiveTab] = useState('images');
    const [startDate, setStartDate] = useState('');
    const [endDate, setEndDate] = useState('');
    const [logType, setLogType] = useState('');
    const [logLevel, setLogLevel] = useState('');

    return (
        <div className="space-y-6">
            {/* Page Header */}
            <div>
                <h1 className="text-2xl font-bold">History</h1>
                <p className="text-[var(--color-text-secondary)] mt-1">
                    Browse and filter processed images and system logs
                </p>
            </div>

            {/* Tab Navigation */}
            <div className="flex gap-1 border-b border-[var(--color-border)]">
                <button
                    onClick={() => setActiveTab('images')}
                    className={`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === 'images'
                            ? 'border-black text-black'
                            : 'border-transparent text-[var(--color-text-secondary)] hover:text-black'
                        }`}
                >
                    Images
                </button>
                <button
                    onClick={() => setActiveTab('logs')}
                    className={`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${activeTab === 'logs'
                            ? 'border-black text-black'
                            : 'border-transparent text-[var(--color-text-secondary)] hover:text-black'
                        }`}
                >
                    Logs
                </button>
            </div>

            {/* Filter Bar */}
            <FilterBar
                startDate={startDate}
                endDate={endDate}
                logType={logType}
                logLevel={logLevel}
                onStartDateChange={setStartDate}
                onEndDateChange={setEndDate}
                onLogTypeChange={setLogType}
                onLogLevelChange={setLogLevel}
                showLogFilters={activeTab === 'logs'}
            />

            {/* Content */}
            {activeTab === 'images' ? (
                <ImageGrid startDate={startDate} endDate={endDate} />
            ) : (
                <LogTable
                    startDate={startDate}
                    endDate={endDate}
                    logType={logType}
                    logLevel={logLevel}
                />
            )}
        </div>
    );
}
</file>

<file path="src/pages/System.jsx">
/**
 * System Page
 * System configuration and maintenance (placeholder).
 */

import { useStatus } from '../hooks/useStatus';
import { useCleanupLogs, useClearHotLogs } from '../hooks/useLogs';
import { formatDateTime } from '../utils/formatters';

export default function System() {
    const { data: status } = useStatus();
    const cleanupMutation = useCleanupLogs();
    const clearHotMutation = useClearHotLogs();

    const handleCleanup = async () => {
        if (window.confirm('Delete logs older than 90 days?')) {
            await cleanupMutation.mutateAsync(90);
            alert(`Cleaned up ${cleanupMutation.data?.deleted_count ?? 0} old logs`);
        }
    };

    const handleClearHot = async (type) => {
        if (window.confirm(`Clear ${type || 'all'} hot logs?`)) {
            await clearHotMutation.mutateAsync(type);
        }
    };

    return (
        <div className="space-y-6">
            {/* Page Header */}
            <div>
                <h1 className="text-2xl font-bold">System</h1>
                <p className="text-[var(--color-text-secondary)] mt-1">
                    System configuration and maintenance tools
                </p>
            </div>

            {/* System Info */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Server Info */}
                <div className="card">
                    <h2 className="text-lg font-semibold mb-4">Server Information</h2>
                    <div className="space-y-3 text-sm">
                        <div className="flex justify-between py-2 border-b border-[var(--color-border-light)]">
                            <span className="text-[var(--color-text-secondary)]">Status</span>
                            <span className="font-medium flex items-center gap-2">
                                <span className="status-dot success" />
                                {status?.status ?? 'Unknown'}
                            </span>
                        </div>
                        <div className="flex justify-between py-2 border-b border-[var(--color-border-light)]">
                            <span className="text-[var(--color-text-secondary)]">Uptime</span>
                            <span className="font-medium">
                                {Math.floor((status?.uptime_seconds ?? 0) / 60)} minutes
                            </span>
                        </div>
                        <div className="flex justify-between py-2 border-b border-[var(--color-border-light)]">
                            <span className="text-[var(--color-text-secondary)]">Memory Usage</span>
                            <span className="font-medium">{status?.system?.memory_mb ?? 0} MB</span>
                        </div>
                        <div className="flex justify-between py-2 border-b border-[var(--color-border-light)]">
                            <span className="text-[var(--color-text-secondary)]">CPU Usage</span>
                            <span className="font-medium">{status?.system?.cpu_percent ?? 0}%</span>
                        </div>
                        <div className="flex justify-between py-2">
                            <span className="text-[var(--color-text-secondary)]">Threads</span>
                            <span className="font-medium">{status?.system?.threads ?? 0}</span>
                        </div>
                    </div>
                </div>

                {/* Queue Info */}
                <div className="card">
                    <h2 className="text-lg font-semibold mb-4">Queue Configuration</h2>
                    <div className="space-y-3 text-sm">
                        <div className="flex justify-between py-2 border-b border-[var(--color-border-light)]">
                            <span className="text-[var(--color-text-secondary)]">Max Size</span>
                            <span className="font-medium">{status?.queue?.max_size ?? 100}</span>
                        </div>
                        <div className="flex justify-between py-2 border-b border-[var(--color-border-light)]">
                            <span className="text-[var(--color-text-secondary)]">Current Size</span>
                            <span className="font-medium">{status?.queue?.current_size ?? 0}</span>
                        </div>
                        <div className="flex justify-between py-2 border-b border-[var(--color-border-light)]">
                            <span className="text-[var(--color-text-secondary)]">Total Pushed</span>
                            <span className="font-medium">{status?.queue?.total_pushed ?? 0}</span>
                        </div>
                        <div className="flex justify-between py-2">
                            <span className="text-[var(--color-text-secondary)]">Total Popped</span>
                            <span className="font-medium">{status?.queue?.total_popped ?? 0}</span>
                        </div>
                    </div>
                </div>
            </div>

            {/* Maintenance Actions */}
            <div className="card">
                <h2 className="text-lg font-semibold mb-4">Maintenance</h2>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="p-4 bg-[var(--color-bg-secondary)] rounded-lg">
                        <h3 className="font-medium mb-2">Clean Old Logs</h3>
                        <p className="text-sm text-[var(--color-text-secondary)] mb-3">
                            Delete logs older than 90 days from the database.
                        </p>
                        <button
                            onClick={handleCleanup}
                            disabled={cleanupMutation.isPending}
                            className="btn btn-secondary w-full"
                        >
                            {cleanupMutation.isPending ? 'Cleaning...' : 'Clean Logs'}
                        </button>
                    </div>

                    <div className="p-4 bg-[var(--color-bg-secondary)] rounded-lg">
                        <h3 className="font-medium mb-2">Clear Activity Logs</h3>
                        <p className="text-sm text-[var(--color-text-secondary)] mb-3">
                            Clear the real-time activity log buffer.
                        </p>
                        <button
                            onClick={() => handleClearHot('activity')}
                            disabled={clearHotMutation.isPending}
                            className="btn btn-secondary w-full"
                        >
                            Clear Activity
                        </button>
                    </div>

                    <div className="p-4 bg-[var(--color-bg-secondary)] rounded-lg">
                        <h3 className="font-medium mb-2">Clear Server Logs</h3>
                        <p className="text-sm text-[var(--color-text-secondary)] mb-3">
                            Clear the real-time server log buffer.
                        </p>
                        <button
                            onClick={() => handleClearHot('server')}
                            disabled={clearHotMutation.isPending}
                            className="btn btn-secondary w-full"
                        >
                            Clear Server
                        </button>
                    </div>
                </div>
            </div>

            {/* Environment Info */}
            <div className="card">
                <h2 className="text-lg font-semibold mb-4">Environment</h2>
                <div className="bg-[var(--color-bg-secondary)] rounded-lg p-4 font-mono text-sm">
                    <div className="text-[var(--color-text-muted)]">API Endpoint</div>
                    <div className="mb-3">http://127.0.0.1:8000</div>

                    <div className="text-[var(--color-text-muted)]">Storage</div>
                    <div className="mb-3">Cloudflare R2 / KV / D1</div>

                    <div className="text-[var(--color-text-muted)]">Last Updated</div>
                    <div>{formatDateTime(status?.timestamp)}</div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/utils/formatters.js">
/**
 * Date and formatting utilities
 */

/**
 * Format a date as a relative time string (e.g., "2 hours ago")
 */
export function formatRelativeTime(dateString) {
    if (!dateString) return 'Never';

    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffSecs = Math.floor(diffMs / 1000);
    const diffMins = Math.floor(diffSecs / 60);
    const diffHours = Math.floor(diffMins / 60);
    const diffDays = Math.floor(diffHours / 24);

    if (diffSecs < 60) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    if (diffDays < 7) return `${diffDays}d ago`;

    return date.toLocaleDateString();
}

/**
 * Format a date as ISO date string (YYYY-MM-DD)
 */
export function formatDate(dateString) {
    if (!dateString) return '';
    return new Date(dateString).toISOString().split('T')[0];
}

/**
 * Format a date as full datetime string
 */
export function formatDateTime(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleString();
}

/**
 * Format a timestamp for logs (HH:MM:SS.mmm)
 */
export function formatLogTime(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toTimeString().slice(0, 12);
}

/**
 * Format file size in human-readable format
 */
export function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    if (!bytes) return '';

    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
}

/**
 * Format dimensions string
 */
export function formatDimensions(width, height) {
    if (!width || !height) return '';
    return `${width}×${height}`;
}

/**
 * Get today's date as ISO string
 */
export function getToday() {
    return new Date().toISOString().split('T')[0];
}

/**
 * Get date N days ago as ISO string
 */
export function getDaysAgo(days) {
    const date = new Date();
    date.setDate(date.getDate() - days);
    return date.toISOString().split('T')[0];
}
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react(), tailwindcss()],
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://127.0.0.1:8000',
        changeOrigin: true,
      },
    },
  },
})
</file>

</files>
